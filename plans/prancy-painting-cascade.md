# Plan: text-to-slide スキル化

## Context

`.agent/workflows/texttoslide.md` として定義されているワークフローは、テキストファイルからMarpスライドを生成し、`marp_to_prompts.js` で画像生成プロンプトに変換する手順書である。現状はワークフロー文書として存在するが、AIが自動で認識・実行できるスキル形式に変換することで、ユーザーが自然言語でスキルを呼び出せるようにする。

**解決する課題:**
- ワークフロー文書は人間が読む手順書であり、AIが自動発動できない
- WindowsパスのハードコードをmacOS環境で汎用化する必要がある
- `image-gen` スキルと同様のパターンで統一感を持たせる

---

## 作成するファイル

### 1. `.agent/skills/text-to-slide/SKILL.md`（メインスキルファイル）

```markdown
---
name: text-to-slide
description: |
  テキストやMarkdownファイルからMarp形式のスライドを作成し、
  画像生成用プロンプトファイルへ変換するスキル。

  【発動条件】
  - 「スライドを作って」「プレゼンを作成」「テキストからスライド」
  - 「Marpで作って」「スライド資料を作りたい」「スライドにして」
  - テキストファイルやMarkdownを渡して「スライドにして」と依頼された場合
  - `text-to-slide` コマンド

  【注意】
  - このスキルはMarpスライド生成 + 画像プロンプト変換を一括で行う
  - 実際の画像生成は `image-gen` スキルを使用すること
version: 1.0.0
---

# Text to Slide スキル

テキストデータやMarkdownファイルを元に、Marp形式のスライド資料を作成し、
各スライドの画像生成用プロンプトファイルへの変換まで一括で行うスキルです。

## ワークフロー

### Step 1: Marpスライドの生成

ユーザーが指定したテキストやファイルを元にMarpスライドを作成し、ファイルに書き出す。

**生成ルール:**

- Frontmatterに `marp: true`、`theme: default` を必ず含める
- 構成: 表紙スライド（タイトル + サブタイトル）+ 内容に応じた適切な枚数
- スライドの区切りは `---` を使用する
- 出力ファイル名: `[元のファイル名]_slide.md`（元ファイルと同じディレクトリ）

**Marpスライドの基本構造:**

\`\`\`markdown
---
marp: true
theme: default
---

# タイトル

サブタイトル

---

## セクション見出し

- ポイント1
- ポイント2
\`\`\`

### Step 2: プロンプト生成スクリプトの実行

Marpスライドファイルが完成したら、Bashツールで以下を実行する。
`[SLIDE_FILE_PATH]` には Step 1 で作成したスライドファイルの**絶対パス**を使用すること。

\`\`\`bash
node [PROJECT_ROOT]/scripts/marp_to_prompts.js "[SLIDE_FILE_PATH]"
\`\`\`

スクリプトの動作:
- Marpファイルを `---` でスライドごとに分割
- 各スライドに画像生成用テンプレートを付加
- **スライドファイルと同じディレクトリ**の `prompts/{YYYY-MM-DD_HH-MM-SS}/` に出力

### Step 3: 出力確認と報告

スクリプト実行後、以下をユーザーに報告する:

1. 作成されたスライドファイルのパス
2. 生成されたプロンプトファイルの保存先ディレクトリ
3. 生成されたファイル数（スライド枚数）

## 使用例

### テキストファイルからスライドを作成

\`\`\`
article/summary.md を元にスライド資料を作成してください
\`\`\`

AIの実行手順:
1. `Read` ツールで `article/summary.md` を読み込む
2. 内容を分析してスライド構成を決定する
3. `Write` ツールで `article/summary_slide.md` を作成する
4. `Bash` ツールで `node scripts/marp_to_prompts.js "article/summary_slide.md"` を実行
5. 生成されたファイルを確認・報告する

### テキストを直接渡してスライドを作成

\`\`\`
以下のテキストをスライドにしてください:（テキスト内容）
\`\`\`

AIの実行手順:
1. テキストを分析してスライド構成を決定する
2. ファイル名をユーザーに確認するか内容から命名する
3. `Write` ツールでスライドファイルを作成する
4. `Bash` ツールでスクリプトを実行する
5. 生成されたファイルを確認・報告する

## 前提条件

- Node.js がインストール済みであること
- プロジェクトルートに `scripts/marp_to_prompts.js` が存在すること

## 関連スキル

- **image-gen**: 生成されたプロンプトファイルを使って画像を生成する場合はこちらを使用
```

### 2. `.agent/skills/text-to-slide/CLAUDE.md`（claude-mem用・最小構成）

```markdown
<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

_No recent activity_
</claude-mem-context>
```

---

## 重要な設計判断

### スクリプトパスの汎用化
元のワークフローはWindowsパス（`e:\development\work\...`）がハードコードされていた。スキルでは `[PROJECT_ROOT]/scripts/marp_to_prompts.js` として記述し、AIが実行時にワーキングディレクトリから正しいパスを解決する。

### 出力先の明確化
`marp_to_prompts.js` の実際のコードを確認した結果、出力先は `path.dirname(inputFile)` を基準に決まる。元のワークフロー文書の記述が曖昧だったため、スキルでは「スライドファイルと同じディレクトリの `prompts/` サブディレクトリ」と明記する。

---

## 検証手順

1. スキルファイル作成後、テストテキストを用意して「スライドを作って」と依頼する
2. Marpファイルが `[ファイル名]_slide.md` として正しく生成されることを確認
3. `marp_to_prompts.js` が実行され `prompts/{timestamp}/` ディレクトリにファイルが生成されることを確認
4. スライド枚数と生成されたプロンプトファイル数が一致することを確認

---

## 対象ファイル

| 操作 | ファイルパス |
|------|------------|
| 作成 | `.agent/skills/text-to-slide/SKILL.md` |
| 作成 | `.agent/skills/text-to-slide/CLAUDE.md` |
| 参照 | `.agent/skills/image-gen/SKILL.md`（フォーマット参照） |
| 参照 | `scripts/marp_to_prompts.js`（スクリプト仕様確認済み） |
| 参照 | `.agent/workflows/texttoslide.md`（変換元） |
